<!--
  A background page that manages notifications.

  Copyright 2010 the Chromium Authors

  Use of this source code is governed by a BSD-style license that can be found
  in the "LICENSE" file.

  Brian Kennish <bkennish@chromium.org>
-->
<!--http://api.twitter.com/1/statuses/user_timeline.json?screen_name=SkyNewsBreak-->
<!-- http://twitter.com/about/resources/widgets/widget_profile-->
<script src = "/js/jquery-1.6.1.js"></script>
<script src = "/js/jquery.jqote2.js"></script>
<script src = "/js/background.js"></script>
<script src = "/js/globals.js"></script>

<script type="text/x-jqote-template" id="template">
    <![CDATA[
    <li>
        <a href="<%= this.href %>"><%= this.link %></a>
    </li>
    ]]>
</script>

<script>
	
  //Adding twitter enabled for demo
  window.localStorage.setItem('isTwitterEnabled', true);
  window.localStorage.setItem('rssFeedToFollow', 'http://news.sky.com/sky-news/rss/home/rss.xml');
  // Test for notification support.
  if (webkitNotifications) {
    var interval = 0; // The display interval, in minutes.

    setInterval(function() {
      interval++;
      background.show();            
    }, globals.waitTime); 
  } else {
    // Show a new tab with an error message.
    chrome.tabs.create({url: 'error.html'});
  }


var listOfListeners = []
//General listener
    chrome.extension.onConnect.addListener(function(port) {
        listOfListeners.push(port);
            console.log('inside of add Listener', port);
          console.assert(port.name == "knockknock");
          port.onMessage.addListener(function(msg) {
            if (msg.joke == "Knock knock")
              port.postMessage({question: "Who's there?"});
            else if (msg.answer == "Madame")
              port.postMessage({question: "Madame who?"});
            else if (msg.answer == "Madame... Bovary"){
                  port.postMessage({question: "I don't get it."});
                  
                  console.log('size of array is ', listOfListeners);
                  listOfListeners.each(function(i){
                    listOfListeners[i].postMessage('Something else');
                  });
              }
              
          });
    });

/*  
  chrome.extension.onRequest.addListener(
      function(request, sender, sendResponse) {
        console.log(sender.tab ?
                    "from a content script:" + sender.tab.url :
                    "from the extension id:"+sender.id);
        if (request.greeting == "hello")
          sendResponse({farewell: "goodbye "});
        else
          sendResponse({}); // snub them.
  });
  */
</script>
